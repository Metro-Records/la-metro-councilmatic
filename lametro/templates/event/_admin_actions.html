{% load lametro_extras %}

{% get_events_with_manual_broadcasts as manual_events %}
<div class="card p-0">
    <div class="card-header">
        <i class= "fa fa-wrench fa-fw" aria-hidden="true"></i>
        Admin Actions
    </div>
    <ul class="list-group list-group-flush p-2">
        {% if not event_ok %}
            <li class="list-group-item">
                <p class="card-text">This event does not exist in Legistar. It may have been deleted from Legistar due to being a duplicate. To delete this event, click the button below.</p>
                <a href="{% url 'delete_event' event.slug %}" class='btn btn-teal' style="margin-bottom: 20px"><i class="fa fa-times" aria-hidden="true"></i> Delete Event</a>
            </li>
        {% elif event.status != 'cancelled' %}
            <li class="list-group-item">
                {% if event.has_manual_broadcast and event.media.all.exists %}
                    <p class="card-text">
                        This event now has a proper broadcast link, and the previous manual broadcast can now be unpublished.
                        Please unpublish the manual link.
                    </p>
                    <a href="{% url 'manual_event_live_link' event.slug %}" class="btn btn-teal"><i class= "fa fa-headphones" aria-hidden="true"></i> Unpublish Watch Live Link</a>
                {% elif event.media.all.exists %}
                    <p class="card-text">This event has a proper broadcast link, and cannot have a manual broadcast published.</p>
                {% elif not event.has_manual_broadcast and manual_events|length >= 1 %}
                    <p class="card-text">
                        Please unpublish any existing manually live links before publishing this one.
                        The following event already has a manual broadcast at the moment:
                    </p>
                    <ul>
                        {% for m_event in manual_events %}
                            <li style="font-size:16px">
                                <a href="/event/{{m_event.slug}}">{{m_event.name}}</a>
                            </li>
                        {% endfor %}
                    </ul>
                    <button class='btn btn-teal' disabled style="margin-bottom: 20px"><i class="fa fa-headphones" aria-hidden="true"></i> Publish Watch Live Link</button>
                {% elif not event.has_manual_broadcast %}
                    <p class="card-text">
                        You can manually publish a "Watch Live" link for this meeting if needed.
                        Once the scheduled end time has passed, you will be responsible for undoing this change.
                        Please be advised that this should only be done if Legistar is currently unavailable.
                    </p>
                    <a href="{% url 'manual_event_live_link' event.slug %}" class="btn btn-teal"><i class= "fa fa-headphones" aria-hidden="true"></i> Publish Watch Live Link</a>
                {% else %}
                    <p class="card-text">
                        This meeting currently has a manually published "Watch Live" link.
                        Once the scheduled end time has passed, you will be responsible for unpublishing this link.
                    </p>
                    <a href="{% url 'manual_event_live_link' event.slug %}" class="btn btn-teal"><i class= "fa fa-headphones" aria-hidden="true"></i> Unpublish Watch Live Link</a>
                {% endif %}
            </li>
            <li class="list-group-item">
                {% if agenda_url %}
                    <p class="card-text">This event's agenda has been scraped.{% if event.manual_agenda %} This event also has a manually uploaded agenda. Go to the CMS to remove it.{% endif %}</p>
                {% else %}
                    <p class="card-text">Go to the CMS to upload an agenda for this event.</p>
                {% endif %}
            </li>
        {% endif %}
    </ul>
</div>
